<%
/**
 * SuperAdmin Users Management Page
 * Follows main dashboard layout structure with atomic design components
 *
 * Layout Structure (matching main dashboard):
 * - Direct row/column structure (no body-wrapper)
 * - Container-fluid from Flexy Bootstrap
 * - Consistent spacing and alignment
 *
 * Note: DataTables CSS/JS libraries are loaded via controller (pageStyles & footerScripts)
 */

// Page configuration
const currentUserRole = typeof userRole !== 'undefined' ? userRole : 'superadmin';
const currentPath = '/dashboard/superadmin/users';
%>

<!-- Page Header with Breadcrumb -->
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="mb-1 fw-bold">Gestión de Usuarios</h2>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item">
                            <a href="/dashboard/superadmin" class="text-decoration-none">
                                <i class="ti ti-home me-1"></i>Dashboard
                            </a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">
                            <i class="ti ti-users me-1"></i>Usuarios
                        </li>
                    </ol>
                </nav>
            </div>
            <div class="text-muted">
                <small class="d-block">Total usuarios registrados</small>
                <strong id="total-users-count">-</strong>
            </div>
        </div>
    </div>
</div>

<!-- Users DataTable -->
<div class="row">
    <div class="col-12">
        <%- include('../../organisms/datatable/users-table', {
            tableId: 'users-table',
            apiEndpoint: '/api/users',
            userRole: currentUserRole,
            showActions: true
        }) %>
    </div>
</div>

<!-- User Management Modals -->
<!-- Create User Modal -->
<div class="modal fade" id="createUserModal" tabindex="-1" aria-labelledby="createUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createUserModalLabel">
                    <i class="ti ti-user-plus me-2"></i>Crear Nuevo Usuario
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Create user form will go here -->
                <p class="text-muted">Formulario de creación de usuario pendiente de implementar</p>
            </div>
        </div>
    </div>
</div>

<!-- Edit User Modal -->
<div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editUserModalLabel">
                    <i class="ti ti-edit me-2"></i>Editar Usuario
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Edit user form will go here -->
                <p class="text-muted">Formulario de edición de usuario pendiente de implementar</p>
            </div>
        </div>
    </div>
</div>

<!-- View User Modal -->
<div class="modal fade" id="viewUserModal" tabindex="-1" aria-labelledby="viewUserModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewUserModalLabel">
                    <i class="ti ti-eye me-2"></i>Detalles de Usuario
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- User details will go here -->
                <p class="text-muted">Vista de detalles de usuario pendiente de implementar</p>
            </div>
        </div>
    </div>
</div>

<!-- Page-specific JavaScript -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Update total count when table loads (listen to custom event)
        document.addEventListener('usersTableLoaded', function(e) {
            const count = e.detail?.count || 0;
            const countEl = document.getElementById('total-users-count');
            if (countEl) {
                countEl.textContent = count;
            }
        });
    });
</script>