<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title><%= typeof title !== 'undefined' ? title : 'Amexing - Transportation Management' %></title>

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/png" href="/flexy-bootstrap-lite-1.0.0/assets/images/logos/favicon.png" />

    <!-- Core CSS -->
    <link rel="stylesheet" href="/flexy-bootstrap-lite-1.0.0/assets/css/styles.min.css" />

    <!-- Tabler Icons -->
    <link rel="stylesheet" href="/flexy-bootstrap-lite-1.0.0/assets/css/icons/tabler-icons/tabler-icons.css">

    <!-- Auth-specific styles -->
    <style>
        /* Auth Layout Styles */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .auth-wrapper {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem 1rem;
            position: relative;
            overflow: hidden;
        }

        .auth-wrapper.with-header {
            min-height: calc(100vh - 200px);
            padding-top: 1rem;
        }

        .auth-wrapper::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml,<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="1"/></pattern></defs><rect width="100%" height="100%" fill="url(%23grid)" /></svg>');
            animation: float 20s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(30px, -30px) rotate(120deg); }
            66% { transform: translate(-20px, 20px) rotate(240deg); }
        }

        .auth-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            padding: 3rem;
            position: relative;
            z-index: 2;
            transform: translateY(0);
            transition: all 0.3s ease;
        }

        .auth-wrapper.with-header .auth-card {
            max-width: 600px;
            padding: 2rem;
        }

        .auth-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .auth-logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .auth-logo img {
            max-height: 60px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .auth-title {
            text-align: center;
            color: #2d3748;
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .auth-subtitle {
            text-align: center;
            color: #718096;
            font-size: 1rem;
            margin-bottom: 2rem;
        }

        /* Form Styles */
        .form-control {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            padding: 0.875rem 1rem;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            background: rgba(255, 255, 255, 0.95);
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        .btn {
            border-radius: 12px;
            padding: 0.875rem 1.5rem;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        /* Loading Animation */
        .auth-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(102, 126, 234, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .auth-loading.show {
            opacity: 1;
            visibility: visible;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 576px) {
            .auth-card {
                padding: 2rem 1.5rem;
                margin: 1rem;
                border-radius: 16px;
            }

            .auth-title {
                font-size: 1.5rem;
            }

            .auth-subtitle {
                font-size: 0.875rem;
            }
        }

        /* Accessibility */
        .sr-only {
            position: absolute !important;
            width: 1px !important;
            height: 1px !important;
            padding: 0 !important;
            margin: -1px !important;
            overflow: hidden !important;
            clip: rect(0,0,0,0) !important;
            white-space: nowrap !important;
            border: 0 !important;
        }

        /* Focus indicators */
        a:focus,
        button:focus,
        input:focus,
        select:focus,
        textarea:focus {
            outline: 2px solid #667eea;
            outline-offset: 2px;
        }
    </style>

    <!-- Page-specific styles -->
    <% if (typeof additionalStyles !== 'undefined' && additionalStyles && Array.isArray(additionalStyles)) { %>
        <% additionalStyles.forEach(function(style) { %>
            <% if (typeof style === 'string' && (style.startsWith('/') || style.startsWith('https://cdnjs.cloudflare.com/'))) { %>
            <link rel="stylesheet" href="<%= style %>" />
            <% } %>
        <% }); %>
    <% } %>
</head>

<body>
    <!-- Loading Screen -->
    <div class="auth-loading" id="authLoader">
        <div class="loading-spinner"></div>
        <span class="sr-only">Loading...</span>
    </div>

    <!-- Auth Header (if requested) -->
    <% if (typeof showAuthHeader !== 'undefined' && showAuthHeader && typeof headerConfig !== 'undefined') { %>
        <%- include('../organisms/auth/auth-header', {
            page: typeof page !== 'undefined' ? page : 'login',
            title: headerConfig.title,
            subtitle: headerConfig.subtitle,
            corporate: headerConfig.corporate,
            showLogo: typeof headerConfig.showLogo !== 'undefined' ? headerConfig.showLogo : true,
            showNavigation: typeof headerConfig.showNavigation !== 'undefined' ? headerConfig.showNavigation : true,
            breadcrumbs: headerConfig.breadcrumbs
        }) %>
    <% } %>

    <!-- Auth Wrapper -->
    <div class="auth-wrapper <%= typeof showAuthHeader !== 'undefined' && showAuthHeader ? 'with-header' : '' %>">
        <div class="auth-card">
            <!-- Logo (only if no header) -->
            <% if (!(typeof showAuthHeader !== 'undefined' && showAuthHeader)) { %>
                <div class="auth-logo">
                    <img src="/dashboard/images/logos/amexing-logo.svg"
                         alt="Amexing Logo">
                </div>
            <% } %>

            <!-- Flash Messages -->
            <% if (typeof error !== 'undefined' && error) { %>
                <div class="alert alert-danger d-flex align-items-center mb-4" role="alert">
                    <i class="ti ti-alert-circle me-2"></i>
                    <div><%= error %></div>
                </div>
            <% } %>

            <% if (typeof success !== 'undefined' && success) { %>
                <div class="alert alert-success d-flex align-items-center mb-4" role="alert">
                    <i class="ti ti-circle-check me-2"></i>
                    <div><%= success %></div>
                </div>
            <% } %>

            <!-- Content -->
            <div class="auth-content">
                <% if (typeof content !== 'undefined' && content) { %>
                    <!-- New atomic design content -->
                    <%- content %> <%# nosemgrep: trusted pre-rendered atomic component content %>
                <% } else if (typeof body !== 'undefined' && body) { %>
                    <!-- Legacy body content -->
                    <%- body %> <%# nosemgrep: trusted pre-rendered template content %>
                <% } else { %>
                    <!-- Default forgot password form if no content provided -->
                    <%- include('../molecules/auth/forgot-password-form', {
                        error: typeof error !== 'undefined' ? error : '',
                        success: typeof success !== 'undefined' ? success : '',
                        csrfToken: typeof csrfToken !== 'undefined' ? csrfToken : '',
                        email: typeof email !== 'undefined' ? email : '',
                        showBackToLogin: true
                    }) %>
                <% } %>
            </div>
        </div>
    </div>

    <!-- Core JavaScript -->
    <script src="/flexy-bootstrap-lite-1.0.0/assets/libs/jquery/dist/jquery.min.js"></script>
    <script src="/flexy-bootstrap-lite-1.0.0/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Auth Layout Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Hide loading screen
            const loader = document.getElementById('authLoader');
            if (loader) {
                setTimeout(() => {
                    loader.classList.remove('show');
                }, 300);
            }

            // Smooth form animations
            const inputs = document.querySelectorAll('.form-control');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.parentElement.classList.add('focused');
                });

                input.addEventListener('blur', function() {
                    if (!this.value) {
                        this.parentElement.classList.remove('focused');
                    }
                });

                // Pre-fill animation for auto-filled inputs
                if (input.value) {
                    input.parentElement.classList.add('focused');
                }
            });

            // Form submission loading state
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                form.addEventListener('submit', function() {
                    const submitBtn = form.querySelector('button[type="submit"]');
                    if (submitBtn) {
                        submitBtn.innerHTML = `
                            <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                            Processing...
                        `;
                        submitBtn.disabled = true;
                    }

                    if (loader) {
                        loader.classList.add('show');
                    }
                });
            });

            // Auto-dismiss alerts
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                if (alert.classList.contains('alert-success')) {
                    setTimeout(() => {
                        const bsAlert = new bootstrap.Alert(alert);
                        bsAlert.close();
                    }, 5000);
                }
            });

            // Enhanced security
            document.addEventListener('keydown', function(e) {
                // Prevent F12, Ctrl+Shift+I, Ctrl+U in production
                if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
                    if (e.key === 'F12' ||
                        (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                        (e.ctrlKey && e.key === 'U')) {
                        e.preventDefault();
                        return false;
                    }
                }
            });

        });

        // Global error handler
        window.addEventListener('error', function(e) {
            console.error('Auth error:', e.error);
        });

        // Prevent context menu in production
        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                return false;
            });
        }
    </script>

    <!-- Page-specific scripts -->
    <% if (typeof additionalScripts !== 'undefined' && additionalScripts && Array.isArray(additionalScripts)) { %>
        <% additionalScripts.forEach(function(script) { %>
            <% if (typeof script === 'string' && (script.startsWith('/') || script.startsWith('https://cdnjs.cloudflare.com/'))) { %>
            <script src="<%= script %>"></script> <%# nosemgrep: allowlisted script paths %>
            <% } %>
        <% }); %>
    <% } %>

</body>

</html>