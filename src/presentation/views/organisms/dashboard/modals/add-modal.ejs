<%
  /**
   * @param {Object} data - Modal data
   * @param {string} data.modalId - Modal ID
   * @param {string} data.title - Modal title
   * @param {string} [data.icon] - Modal icon name (sin prefijo ti-)
   * @param {string} [data.description] - Texto introductorio
   * @param {Array} [data.inputs] - Lista de inputs del formulario
   * @param {string} data.dataAction - Botón data-action
   * @param {string} [data.primaryLabel] - Texto del botón principal
   * @param {string} [data.secondaryLabel] - Texto del botón secundario
   */
  const {
    modalId,
    title,
    icon = "user-plus",
    description = "Completa los campos requeridos.",
    inputs = [],
    dataAction,
    primaryLabel = "Agregar Usuario",
    secondaryLabel = "Cancelar",
    headerColor = "primary",
    headerStyle = "",
  } = data;
%>

<div class="modal fade" id="<%- modalId %>" tabindex="-1" aria-labelledby="<%- modalId %>Label" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content border-0 shadow-lg">

      <!-- Header -->
      <div class="modal-header bg-<%- headerColor %> text-white" style="<%- headerStyle %>">
        <h5 class="modal-title d-flex align-items-center gap-2 text-white" id="<%- modalId %>Label">
          <i class="ti ti-<%- icon %>"></i>
          <span><%- title %></span>
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>

      <!-- Body -->
      <div class="modal-body">
        <p class="text-muted mb-4"><%- description %></p>

        <% if (inputs.length > 0) { %>

          <% inputs.forEach((input) => { %>

            <div class="mb-3" <%-input.hidden ? 'hidden' : ''%>>

              <label for="<%- input.id %>" class="form-label fw-bold">
                <%- input.label %>
                <% if (input.required) { %>
                  <span class="text-danger">*</span>
                <% } %>
              </label>

              <% if (input.type === "textarea") { %>

                <textarea 
                  class="form-control"
                  id="<%- input.id %>"
                  name="<%- input.name %>"
                  rows="<%- input.rows || 4 %>"
                  maxlength="<%- input.maxLength || 500 %>"
                  placeholder="<%- input.placeholder || '' %>"
                  aria-label="<%- input.label %>"
                  <%- input.required ? 'required' : '' %>>
                    <%- input.value || '' %>
                </textarea>

              <% } else if (input.type === "select") { %>

                <select 
                  class="form-control form-select select-modals"
                  id="<%- input.id %>"
                  name="<%- input.name %>"
                  aria-label="<%- input.label %>"
                  <%- input.required ? 'required' : '' %>
                  <%- input.multiple %>>
                    <% input.options.forEach((option) => { %>
                      <option value="<%- option.value %>"><%- option.label %></option>
                    <% }) %>
                </select>

              <% } else { %>

                <input 
                  type="<%- input.type || 'text' %>"
                  class="form-control"
                  id="<%- input.id %>"
                  name="<%- input.name %>"
                  value="<%- input.value || '' %>"
                  maxlength="<%- input.maxLength || 100 %>"
                  placeholder="<%- input.placeholder || '' %>"
                  aria-label="<%- input.label %>"
                  <%- input.required ? 'required' : '' %>>

              <% } %>

              <% if (input.helper) { %>

                <div class="form-text">
                  <i class="ti ti-info-circle me-1"></i>
                  <%- input.helper %>
                </div>

              <% } %>

              <div 
                id="<%- input.id %>ValidationError" 
                class="invalid-feedback" 
                style="display: none;">
              </div>

            </div>

          <% }) %>

        <% } %>

      </div>

      <!-- Footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="ti ti-x me-1"></i> <%- secondaryLabel %>
        </button>
        <button type="button" class="btn btn-primary" data-action="<%- dataAction %>">
          <i class="ti ti-check me-1"></i> <%- primaryLabel %>
        </button>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', () => {
    const selects = document.getElementsByClassName('select-modals');

    Array.from(selects).forEach((el) => {
      new Choices(el, {
        searchEnabled: false,  // desactiva el buscador
        itemSelectText: '',    // oculta texto del ícono de selección
        shouldSort: false      // mantiene el orden original de las opciones
      });
    });
  });
</script>